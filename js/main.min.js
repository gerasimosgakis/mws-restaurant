let restaurants,neighborhoods,cuisines;var map,markers=[];function toggleFavorite(e,t){t?(e.classList.add("red-heart"),e.setAttribute("aria-label","unmark favorite")):(e.classList.remove("red-heart"),e.setAttribute("aria-label","mark as favorite"))}document.addEventListener("DOMContentLoaded",e=>{DBHelper.addRestaurants().then(()=>{fetchNeighborhoods(),fetchCuisines()}),DBHelper.addReviews().then(()=>{console.log("first reviews added")})}),fetchNeighborhoods=(()=>{DBHelper.openDatabase().then(e=>{return e.transaction("restaurants","readonly").objectStore("restaurants").getAll()}).then(e=>{let t=[];return Promise.all(e.map(e=>{t.indexOf(e.neighborhood)<0&&t.push(e.neighborhood)})),t}).then(e=>{self.neighborhoods=e,fillNeighborhoodsHTML()})}),fillNeighborhoodsHTML=((e=self.neighborhoods)=>{const t=document.getElementById("neighborhoods-select");e.forEach(e=>{const n=document.createElement("option");n.innerHTML=e,n.value=e,t.append(n)})}),fetchCuisines=(()=>{DBHelper.openDatabase().then(e=>{return e.transaction("restaurants","readonly").objectStore("restaurants").getAll()}).then(e=>{let t=[];return Promise.all(e.map(e=>{t.indexOf(e.cuisine_type)<0&&t.push(e.cuisine_type)})),t}).then(e=>{self.cuisines=e,fillCuisinesHTML()})}),fillCuisinesHTML=((e=self.cuisines)=>{const t=document.getElementById("cuisines-select");e.forEach(e=>{const n=document.createElement("option");n.innerHTML=e,n.value=e,t.append(n)})}),window.initMap=(()=>{self.map=new google.maps.Map(document.getElementById("map"),{zoom:12,center:{lat:40.722216,lng:-73.987501},scrollwheel:!1}),updateRestaurants()}),updateRestaurants=(()=>{const e=document.getElementById("cuisines-select"),t=document.getElementById("neighborhoods-select"),n=e.selectedIndex,a=t.selectedIndex,r=e[n].value,s=t[a].value,o=[];DBHelper.openDatabase().then(e=>{return e.transaction("restaurants","readonly").objectStore("restaurants").openCursor()}).then(function e(t){if(t)return"all"===s&&"all"===r?o.push(t.value):"all"===s?t.value.cuisine_type===r&&o.push(t.value):"all"===r?t.value.neighborhood===s&&o.push(t.value):t.value.neighborhood===s&&t.value.cuisine_type===r&&o.push(t.value),t.continue().then(e)}).then(()=>{resetRestaurants(o),fillRestaurantsHTML()})}),resetRestaurants=(e=>{self.restaurants=[],document.getElementById("restaurants-list").innerHTML="",self.markers.forEach(e=>e.setMap(null)),self.markers=[],self.restaurants=e}),fillRestaurantsHTML=((e=self.restaurants)=>{const t=document.getElementById("restaurants-list");e.forEach(e=>{t.append(createRestaurantHTML(e))}),addMarkersToMap()}),createRestaurantHTML=(e=>{console.log("REST",e);const t=document.createElement("li"),n=document.createElement("img");let a;n.alt=e.name+" restaurant's cover photo","IntersectionObserver"in window?(a=new IntersectionObserver(function(e,t){e.forEach(e=>{e.intersectionRatio>0&&(r(e.target),t.unobserve(e.target))})},{threshold:.1})).observe(n):r(n);const r=t=>{t.className="restaurant-img",t.setAttribute("tabindex","0"),window.innerWidth<=400||window.innerWidth>750&&window.innerWidth<=1e3?t.src=DBHelper.imageUrlForRestaurantSmall(e):t.src=DBHelper.imageUrlForRestaurantMedium(e)};t.append(n);const s=document.createElement("h3");s.innerHTML=e.name,s.setAttribute("tabindex","0"),t.append(s);const o=document.createElement("span");o.innerHTML="❤",o.classList.add("favorite-button"),o.onclick=function(){const t=!e.is_favorite;DBHelper.updateFavorite(e.id,t),e.is_favorite=!e.is_favorite,toggleFavorite(o,e.is_favorite)},toggleFavorite(o,e.is_favorite),t.append(o);const i=document.createElement("p");i.innerHTML=e.neighborhood,i.setAttribute("tabindex","0"),t.append(i);const l=document.createElement("p");l.innerHTML=e.address,l.setAttribute("tabindex","0"),t.append(l);const d=document.createElement("a");return d.innerHTML="View Details",d.href=DBHelper.urlForRestaurant(e),t.append(d),t}),addMarkersToMap=((e=self.restaurants)=>{e.forEach(e=>{const t=DBHelper.mapMarkerForRestaurant(e,self.map);google.maps.event.addListener(t,"click",()=>{window.location.href=t.url}),self.markers.push(t)})});const swap_map=()=>{"none"===document.getElementById("map").style.display&&(document.getElementById("map").style.display="block",document.getElementById("static_map").style.display="none")};